// Prisma schema for MealPlan

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Single meal plan (no users, single-user app)
model MealPlan {
  id         String   @id @default("singleton")
  startDate  String?  // ISO date (YYYY-MM-DD)
  currentDay String?  // ISO date (YYYY-MM-DD)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  days       DayPlan[]
}

model DayPlan {
  id         String   @id @default(cuid())
  mealPlanId String
  mealPlan   MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)
  date       String   // ISO date (YYYY-MM-DD)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  meals      Meal[]

  @@unique([mealPlanId, date])
  @@index([mealPlanId])
}

model Meal {
  id        String   @id @default(cuid())
  dayPlanId String
  dayPlan   DayPlan  @relation(fields: [dayPlanId], references: [id], onDelete: Cascade)
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([dayPlanId])
}
